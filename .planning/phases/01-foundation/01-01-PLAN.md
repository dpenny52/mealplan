---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - app.json
  - babel.config.js
  - metro.config.js
  - .env
  - convex/schema.ts
  - convex/households.ts
  - src/constants/theme.ts
  - src/constants/household.ts
autonomous: true

must_haves:
  truths:
    - "Project has TypeScript configured and compiles without errors"
    - "Convex CLI is installed and project is connected to Convex cloud"
    - "Database schema is deployed with households table"
    - "Hardcoded household ID exists and is valid"
  artifacts:
    - path: "tsconfig.json"
      provides: "TypeScript configuration"
    - path: "convex/schema.ts"
      provides: "Database schema with households, recipes, mealPlans, groceryItems tables"
      contains: "defineSchema"
    - path: "convex/households.ts"
      provides: "Household query/mutation functions"
      exports: ["getOrCreateHousehold"]
    - path: "src/constants/household.ts"
      provides: "Hardcoded HOUSEHOLD_ID constant"
      contains: "HOUSEHOLD_ID"
    - path: "src/constants/theme.ts"
      provides: "Dark mode color definitions"
      contains: "Colors"
    - path: ".env"
      provides: "Convex URL environment variable"
      contains: "EXPO_PUBLIC_CONVEX_URL"
  key_links:
    - from: "convex/schema.ts"
      to: "Convex cloud"
      via: "npx convex dev deployment"
      pattern: "schema deployed"
---

<objective>
Set up project infrastructure: TypeScript, Expo Router, Convex backend, and theme constants.

Purpose: Establish the foundation that all subsequent code will build upon. This must be solid before UI work begins.

Output: Working TypeScript project connected to Convex cloud with schema deployed and household ID created.
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and configure TypeScript</name>
  <files>
    - package.json
    - tsconfig.json
    - app.json
    - babel.config.js
    - metro.config.js
  </files>
  <action>
1. Install Expo Router and its peer dependencies:
   ```bash
   npx expo install expo-router react-native-safe-area-context react-native-screens expo-linking expo-constants expo-system-ui
   ```

2. Install Convex:
   ```bash
   npm install convex
   ```

3. Rename App.js to App.tsx (will be replaced by Expo Router entry)

4. Create tsconfig.json with strict mode and Expo Router paths:
   ```json
   {
     "extends": "expo/tsconfig.base",
     "compilerOptions": {
       "strict": true,
       "baseUrl": ".",
       "paths": {
         "@/*": ["src/*"]
       }
     },
     "include": ["**/*.ts", "**/*.tsx", ".expo/types/**/*.ts", "expo-env.d.ts"]
   }
   ```

5. Update app.json to use Expo Router:
   - Add "scheme": "mealplan"
   - Add "plugins": ["expo-router"]
   - Set main entry to "expo-router/entry"

6. Create babel.config.js with Expo Router plugin:
   ```js
   module.exports = function (api) {
     api.cache(true);
     return {
       presets: ['babel-preset-expo'],
       plugins: ['expo-router/babel'],
     };
   };
   ```

7. Update package.json main field to "expo-router/entry"

8. Create metro.config.js for Convex compatibility:
   ```js
   const { getDefaultConfig } = require('expo/metro-config');
   const config = getDefaultConfig(__dirname);
   module.exports = config;
   ```
  </action>
  <verify>
    - `npx tsc --noEmit` completes without errors
    - package.json includes expo-router, convex dependencies
  </verify>
  <done>TypeScript compiles, all dependencies installed, Expo Router configured as entry point</done>
</task>

<task type="auto">
  <name>Task 2: Initialize Convex and deploy schema</name>
  <files>
    - convex/schema.ts
    - convex/households.ts
    - .env
    - src/constants/household.ts
  </files>
  <action>
1. Initialize Convex project (will prompt for login if needed):
   ```bash
   npx convex dev --once
   ```
   This creates the convex/ directory and connects to Convex cloud.

2. Create convex/schema.ts with database schema:
   - households: { name: string }
   - recipes: { householdId, name } with by_household index
   - mealPlans: { householdId, date } with by_household_date index
   - groceryItems: { householdId, name } with by_household index

3. Create convex/households.ts with:
   - getOrCreateHousehold mutation: Creates household if none exists, returns ID
   - getHousehold query: Fetches household by ID

4. Run `npx convex dev --once` again to deploy schema

5. Create a test household and capture its ID by running:
   ```bash
   npx convex run households:getOrCreateHousehold '{"name": "Home"}'
   ```
   This returns the household ID.

6. Create src/constants/household.ts:
   ```typescript
   export const HOUSEHOLD_ID = 'RETURNED_ID_HERE' as Id<'households'>;
   ```
   Replace RETURNED_ID_HERE with the actual ID from step 5.

7. Ensure .env file exists with EXPO_PUBLIC_CONVEX_URL (created by convex init)

8. Add .env to .gitignore if not already there
  </action>
  <verify>
    - `npx convex dev --once` shows "Schema deployed" or similar success
    - .env contains EXPO_PUBLIC_CONVEX_URL
    - src/constants/household.ts has valid ID (not placeholder)
  </verify>
  <done>Convex backend deployed with schema, household created, ID captured in constants</done>
</task>

<task type="auto">
  <name>Task 3: Create theme constants and source directory structure</name>
  <files>
    - src/constants/theme.ts
    - src/app/.gitkeep
  </files>
  <action>
1. Create src/ directory structure:
   ```
   src/
   ├── app/           (Expo Router screens - created in next plan)
   ├── components/    (Shared components)
   ├── constants/     (Theme, household ID)
   └── hooks/         (Custom hooks)
   ```

2. Create src/constants/theme.ts with dark mode colors from CONTEXT.md:
   ```typescript
   export const Colors = {
     background: '#121212',      // Dark gray (Material Design)
     surface: '#1E1E1E',         // Card/surface color
     primary: '#FF9800',         // Orange/amber accent
     text: '#E0E0E0',            // Off-white text
     textSecondary: '#888888',   // Muted text
     textMuted: '#666666',       // Very muted text
     border: '#333333',          // Subtle borders
   } as const;

   export const Spacing = {
     xs: 4,
     sm: 8,
     md: 16,
     lg: 24,
     xl: 32,
   } as const;
   ```

3. Delete the old App.js/App.tsx file (Expo Router uses src/app/_layout.tsx as entry)
  </action>
  <verify>
    - src/constants/theme.ts exists with Colors and Spacing exports
    - Directory structure exists: src/app, src/components, src/constants, src/hooks
    - No App.js or App.tsx in root (would conflict with Expo Router)
  </verify>
  <done>Theme constants defined, source directory structure created, ready for navigation setup</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm install` runs without errors
2. `npx tsc --noEmit` passes
3. `npx convex dev --once` shows successful deployment
4. .env file contains EXPO_PUBLIC_CONVEX_URL
5. src/constants/household.ts has real Convex ID (not placeholder)
</verification>

<success_criteria>
- TypeScript configured and compiling
- Expo Router configured as app entry point
- Convex connected to cloud with schema deployed
- Household created and ID stored in constants
- Theme colors defined matching dark mode spec
- Source directory structure ready for navigation code
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
