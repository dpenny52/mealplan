---
phase: 01-foundation
plan: 03
type: execute
wave: 3
depends_on: ["01-02"]
files_modified:
  - src/app/(tabs)/planner.tsx
  - convex/testSync.ts
autonomous: false

must_haves:
  truths:
    - "Real-time sync works: change in Convex dashboard appears in app within seconds"
    - "App displays data from Convex (proves connection is live)"
    - "User visually confirms app looks correct (dark mode, navigation working)"
  artifacts:
    - path: "src/app/(tabs)/planner.tsx"
      provides: "Planner screen with live Convex data display"
      contains: "useQuery"
    - path: "convex/testSync.ts"
      provides: "Test query for real-time sync verification"
      exports: ["getHousehold"]
  key_links:
    - from: "src/app/(tabs)/planner.tsx"
      to: "convex/testSync.ts"
      via: "useQuery hook calling api.testSync.getHousehold"
      pattern: "useQuery.*testSync"
---

<objective>
Verify real-time sync works and get user confirmation that the foundation is solid.

Purpose: This plan proves the infrastructure works end-to-end. Real-time sync is the core value proposition (SYNC-01), and this verification ensures we don't build features on a broken foundation.

Output: Confirmed working real-time sync, user approval of visual design.
</objective>

<context>
@.planning/PROJECT.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
@.planning/phases/01-foundation/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add real-time data display to Planner screen</name>
  <files>
    - convex/testSync.ts
    - src/app/(tabs)/planner.tsx
  </files>
  <action>
1. Create convex/testSync.ts with a simple query to fetch household:
   ```typescript
   import { query } from './_generated/server';
   import { v } from 'convex/values';

   export const getHousehold = query({
     args: { id: v.id('households') },
     handler: async (ctx, args) => {
       return await ctx.db.get(args.id);
     },
   });
   ```

2. Deploy the new query:
   ```bash
   npx convex dev --once
   ```

3. Update src/app/(tabs)/planner.tsx to display live data:

   - Add imports:
     ```typescript
     import { useQuery } from 'convex/react';
     import { api } from '../../convex/_generated/api';
     import { HOUSEHOLD_ID } from '../../constants/household';
     ```

   - Inside the component, add Convex query:
     ```typescript
     const household = useQuery(api.testSync.getHousehold, { id: HOUSEHOLD_ID });
     ```

   - Update the display to show connection status and household name:
     ```typescript
     <View style={styles.syncStatus}>
       {household === undefined ? (
         <Text style={styles.statusText}>Connecting to Convex...</Text>
       ) : (
         <Text style={styles.statusText}>
           Connected: {household?.name ?? 'Unknown'} household
         </Text>
       )}
     </View>
     ```

   - Add styles for the sync status display:
     ```typescript
     syncStatus: {
       backgroundColor: Colors.surface,
       padding: Spacing.md,
       borderRadius: 8,
       marginBottom: Spacing.lg,
     },
     statusText: {
       color: Colors.primary,
       fontSize: 14,
       textAlign: 'center',
     },
     ```

This creates a visible indicator that real-time sync is working.
  </action>
  <verify>
    - `npx convex dev --once` deploys without errors
    - Planner screen shows "Connected: Home household" (or similar)
    - If connection fails, shows "Connecting to Convex..."
  </verify>
  <done>Planner screen displays live household data from Convex, proving real-time connection works</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 1 Foundation:
- Expo Router with bottom tab navigation (Recipes, Planner, Grocery tabs)
- Dark mode theme throughout (dark gray background, orange accents, off-white text)
- Convex real-time backend connected
- Planner screen shows live connection status
  </what-built>
  <how-to-verify>
1. Start the app:
   ```bash
   npx expo start
   ```
   Then press 'a' for Android emulator or scan QR with Expo Go.

2. **Verify navigation:**
   - App opens to Planner tab (center tab)
   - Tap "Recipes" tab - should show Recipes screen
   - Tap "Grocery" tab - should show Grocery List screen
   - Tap "Planner" tab - should return to Planner screen
   - No crashes or errors during navigation

3. **Verify dark mode:**
   - Background is dark gray (#121212), not black or white
   - Text is off-white, easily readable
   - Tab bar is slightly lighter surface color
   - Active tab icon/label is orange
   - Inactive tabs are muted gray

4. **Verify real-time sync:**
   - Planner screen shows "Connected: Home household"
   - Open Convex dashboard (https://dashboard.convex.dev)
   - Find your project -> Data -> households table
   - Edit the household name (e.g., change "Home" to "Our Home")
   - **Within 2-3 seconds**, the app should update to show new name
   - This proves real-time sync is working

5. **Verify safe areas:**
   - Content is not hidden behind status bar or notch
   - Content is not hidden behind bottom navigation bar
  </how-to-verify>
  <resume-signal>Type "approved" if everything looks good, or describe any issues you see</resume-signal>
</task>

</tasks>

<verification>
Phase 1 complete when:
1. All 3 tabs navigate correctly without crashes
2. Dark mode theme is consistent across all screens
3. Convex shows "Connected" status on Planner screen
4. Editing household name in Convex dashboard updates app in real-time
5. User has approved the visual design and functionality
</verification>

<success_criteria>
- SYNC-01 verified: Real-time sync working (dashboard edit appears in app)
- SYNC-02 verified: Hardcoded household ID connects successfully
- UI-01 verified: Dark mode theme applied consistently
- Navigation working: All tabs accessible, Planner is default
- User approval received
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md`
</output>
