---
phase: 02-recipe-management
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/app/(tabs)/recipes.tsx
  - src/components/recipe/RecipeCard.tsx
  - src/components/recipe/RecipeListItem.tsx
  - src/components/recipe/RecipeSearch.tsx
  - src/hooks/useRecipes.ts
  - src/hooks/useViewMode.ts
autonomous: true

must_haves:
  truths:
    - "User can see all saved recipes in a scrollable list"
    - "User can toggle between card view and compact list view"
    - "User can search recipes by typing in a search box"
    - "Search filters recipes by title or ingredient as user types"
  artifacts:
    - path: "src/app/(tabs)/recipes.tsx"
      provides: "Recipe list screen with search and view toggle"
      min_lines: 80
    - path: "src/components/recipe/RecipeCard.tsx"
      provides: "Card view item with image and title"
      min_lines: 40
    - path: "src/components/recipe/RecipeListItem.tsx"
      provides: "Compact list view item"
      min_lines: 30
    - path: "src/components/recipe/RecipeSearch.tsx"
      provides: "Search input component"
      min_lines: 30
    - path: "src/hooks/useRecipes.ts"
      provides: "Recipe query hook with filtering"
      exports: ["useRecipes", "useFilteredRecipes"]
    - path: "src/hooks/useViewMode.ts"
      provides: "View mode toggle hook with AsyncStorage"
      exports: ["useViewMode"]
  key_links:
    - from: "src/app/(tabs)/recipes.tsx"
      to: "src/hooks/useRecipes.ts"
      via: "useFilteredRecipes hook"
      pattern: "useFilteredRecipes"
    - from: "src/hooks/useRecipes.ts"
      to: "convex/recipes.ts"
      via: "useQuery"
      pattern: "useQuery.*api\\.recipes\\.list"
---

<objective>
Build the recipe list screen with toggleable card/list views and instant search filtering.

Purpose: Users need to browse and find recipes quickly. This provides RECIPE-02 (view collection) and RECIPE-03 (search/filter).
Output: Fully functional recipe list with two view modes and real-time search.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-recipe-management/02-CONTEXT.md
@.planning/phases/02-recipe-management/02-RESEARCH.md
@.planning/phases/02-recipe-management/02-01-SUMMARY.md

# Existing files
@src/app/(tabs)/recipes.tsx
@src/constants/theme.ts
@src/constants/household.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create recipe hooks for data fetching and filtering</name>
  <files>src/hooks/useRecipes.ts, src/hooks/useViewMode.ts</files>
  <action>
Create src/hooks/useRecipes.ts:

```typescript
export function useRecipes() - wraps useQuery(api.recipes.list, { householdId: HOUSEHOLD_ID })
export function useFilteredRecipes(searchQuery: string) - returns useMemo filtered list
```

Filtering logic (from RESEARCH.md):
- If searchQuery is empty, return all recipes
- Otherwise filter where title.toLowerCase().includes(query) OR any ingredient includes(query)
- This is client-side filtering for instant response

Create src/hooks/useViewMode.ts:

```typescript
export function useViewMode() - returns { viewMode: 'card' | 'list', toggleViewMode }
```

- Use AsyncStorage with key '@recipes_view_mode'
- Load on mount with useEffect
- toggleViewMode saves new value to AsyncStorage
- Default to 'card' if no stored preference
  </action>
  <verify>
- npx tsc --noEmit (TypeScript compiles)
- Both hooks export properly
  </verify>
  <done>Recipe data hooks ready with client-side search filtering and persisted view mode</done>
</task>

<task type="auto">
  <name>Task 2: Create recipe display components</name>
  <files>src/components/recipe/RecipeCard.tsx, src/components/recipe/RecipeListItem.tsx, src/components/recipe/RecipeSearch.tsx</files>
  <action>
Create src/components/recipe/ directory with three components:

**RecipeCard.tsx** - Card view for grid display:
- Props: recipe (with _id, title, imageUrl), onPress
- 2-column grid card with image (or placeholder icon if no image)
- Title below image
- Placeholder: Use Ionicons "restaurant" icon in Colors.textMuted
- TouchableOpacity wrapping for navigation
- Dark theme styling with Colors.surface background

**RecipeListItem.tsx** - Compact list item:
- Props: recipe (with _id, title, imageUrl), onPress
- Horizontal row with small thumbnail (or placeholder) + title
- Minimal height for scanning long lists
- TouchableOpacity for navigation

**RecipeSearch.tsx** - Search input:
- Props: value, onChangeText, placeholder
- TextInput styled with dark theme (Colors.surface background, Colors.text)
- Search icon (Ionicons "search") on left
- Clear button (Ionicons "close-circle") when value not empty
- Border radius for pill shape

IMPORTANT: These are simple presentational components. Do NOT make them call hooks directly - they receive data via props.
  </action>
  <verify>
- npx tsc --noEmit (components compile)
- All three files exist with proper exports
  </verify>
  <done>Three recipe display components ready: RecipeCard, RecipeListItem, RecipeSearch</done>
</task>

<task type="auto">
  <name>Task 3: Build recipe list screen with search and view toggle</name>
  <files>src/app/(tabs)/recipes.tsx</files>
  <action>
Replace placeholder recipes.tsx with full implementation:

**Header section:**
- Title "Recipes" (keep existing style)
- View toggle button (Ionicons "grid" for card, "list" for list mode)
- FAB or header button to add recipe (navigation to /recipe/create)

**Search section:**
- RecipeSearch component as ListHeaderComponent
- IMPORTANT: Pass RecipeSearch directly, NOT as arrow function (prevents focus loss per RESEARCH.md pitfall)

**List section:**
- Use FlatList with conditional rendering based on viewMode
- Card mode: numColumns={2} with RecipeCard items
- List mode: numColumns={1} with RecipeListItem items
- Empty state when no recipes (keep existing empty state design)
- Empty search state when search has no matches

**Navigation:**
- onPress navigates to /recipe/[id] (detail screen, will be created in 02-04)

**Data flow:**
- useFilteredRecipes(searchQuery) for data
- useViewMode() for toggle state
- useState for searchQuery

Style consistently with existing dark theme (Colors, Spacing from constants).
  </action>
  <verify>
- npx tsc --noEmit (screen compiles)
- App runs: npx expo start --android
- Recipes tab shows empty state initially
- Toggle button switches between grid/list layout
- Search bar visible and accepts input
  </verify>
  <done>Recipe list screen displays recipes with toggle views and instant search filtering</done>
</task>

</tasks>

<verification>
After all tasks:
1. `npx tsc --noEmit` passes
2. App loads without errors
3. Recipes tab shows empty state (no recipes yet)
4. View toggle button appears and switches layouts
5. Search bar appears and can type (even though no recipes to filter)
6. Add recipe button/FAB navigates (may 404 until wizard created)
</verification>

<success_criteria>
- Recipe list screen shows saved recipes from Convex
- User can toggle between card and list view (persists to AsyncStorage)
- User can search by title or ingredient (instant filtering)
- Empty states for no recipes and no search matches
- Navigation to recipe detail prepared (onPress handler)
- Navigation to add recipe prepared (button/FAB)
</success_criteria>

<output>
After completion, create `.planning/phases/02-recipe-management/02-02-SUMMARY.md`
</output>
