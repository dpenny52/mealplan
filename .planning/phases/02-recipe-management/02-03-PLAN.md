---
phase: 02-recipe-management
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/app/_layout.tsx
  - src/app/recipe/create/_layout.tsx
  - src/app/recipe/create/index.tsx
  - src/app/recipe/create/ingredients.tsx
  - src/app/recipe/create/details.tsx
  - src/contexts/WizardContext.tsx
autonomous: true

must_haves:
  truths:
    - "User can create a new recipe with title and ingredients"
    - "Recipe creation is a multi-step wizard flow"
    - "User can optionally add instructions, prep time, servings, and image"
    - "Completed wizard saves recipe to database"
  artifacts:
    - path: "src/app/recipe/create/_layout.tsx"
      provides: "Wizard modal layout with stack navigation"
      min_lines: 20
    - path: "src/app/recipe/create/index.tsx"
      provides: "Step 1: Title entry"
      min_lines: 50
    - path: "src/app/recipe/create/ingredients.tsx"
      provides: "Step 2: Ingredients entry"
      min_lines: 80
    - path: "src/app/recipe/create/details.tsx"
      provides: "Step 3: Optional details and save"
      min_lines: 100
    - path: "src/contexts/WizardContext.tsx"
      provides: "Shared state across wizard steps"
      exports: ["WizardProvider", "useWizard"]
  key_links:
    - from: "src/app/recipe/create/details.tsx"
      to: "convex/recipes.ts"
      via: "useMutation"
      pattern: "useMutation.*api\\.recipes\\.create"
    - from: "src/app/_layout.tsx"
      to: "src/app/recipe/create/_layout.tsx"
      via: "modal presentation"
      pattern: "presentation.*modal"
---

<objective>
Build a multi-step wizard for creating recipes with title, ingredients, and optional details.

Purpose: Users need a clear, step-by-step flow to add recipes (RECIPE-01). A wizard prevents overwhelming forms and guides data entry.
Output: Working recipe creation flow that saves to Convex.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-recipe-management/02-CONTEXT.md
@.planning/phases/02-recipe-management/02-RESEARCH.md
@.planning/phases/02-recipe-management/02-01-SUMMARY.md

# Existing files
@src/app/_layout.tsx
@src/constants/theme.ts
@src/constants/household.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create wizard context for shared state</name>
  <files>src/contexts/WizardContext.tsx</files>
  <action>
Create src/contexts/ directory and WizardContext.tsx:

```typescript
interface WizardData {
  title: string;
  ingredients: string[];  // Array of free-form lines
  instructions?: string;
  prepTime?: number;
  servings?: number;
  imageUri?: string;  // Local URI before upload
}

interface WizardContextType {
  data: WizardData;
  updateData: (partial: Partial<WizardData>) => void;
  resetData: () => void;
}
```

- WizardProvider wraps children with context
- useWizard hook for accessing context
- Initial state: title='', ingredients=[], others undefined
- resetData clears all fields (call after successful save)

This prevents data loss when navigating between wizard steps (pitfall from RESEARCH.md).
  </action>
  <verify>npx tsc --noEmit (context compiles)</verify>
  <done>Wizard context shares state across all creation steps</done>
</task>

<task type="auto">
  <name>Task 2: Configure modal routing for wizard</name>
  <files>src/app/_layout.tsx, src/app/recipe/create/_layout.tsx</files>
  <action>
Update src/app/_layout.tsx:
- Add Stack.Screen for "recipe/create" with presentation: 'modal'
- headerShown: false (wizard has its own header)

Create src/app/recipe/ directory structure:
```
src/app/recipe/
  create/
    _layout.tsx
    index.tsx (placeholder for now)
    ingredients.tsx (placeholder for now)
    details.tsx (placeholder for now)
```

Create src/app/recipe/create/_layout.tsx:
- Stack navigator wrapping wizard steps
- Wrap with WizardProvider (context from Task 1)
- Screen options with dark theme header styling
- Step titles: "New Recipe", "Ingredients", "Details"

The _layout.tsx in create/ provides the WizardProvider so all steps share state.
  </action>
  <verify>
- npx tsc --noEmit
- Navigate to /recipe/create shows modal (even with placeholder content)
  </verify>
  <done>Modal navigation configured with wizard context provider</done>
</task>

<task type="auto">
  <name>Task 3: Build wizard step screens</name>
  <files>src/app/recipe/create/index.tsx, src/app/recipe/create/ingredients.tsx, src/app/recipe/create/details.tsx</files>
  <action>
**Step 1: index.tsx (Title)**
- TextInput for recipe title
- "Next" button (disabled if title empty)
- Navigation to /recipe/create/ingredients
- Uses useWizard() to read/write title

**Step 2: ingredients.tsx (Ingredients - Required)**
- List of TextInputs for ingredient lines (free-form like "2 cups flour")
- "Add ingredient" button adds new empty line
- Can delete lines with X button
- "Next" button (disabled if no ingredients)
- Navigation to /recipe/create/details

**Step 3: details.tsx (Optional Details + Save)**
- TextInput for instructions (multiline)
- NumberInput for prep time (minutes)
- NumberInput for servings
- Image picker button (uses expo-image-picker)
- "Save Recipe" button

On save:
1. If imageUri exists, upload via generateUploadUrl and fetch (per RESEARCH.md pattern)
2. Call create mutation with all data
3. Call resetData() to clear wizard
4. Navigate back (dismisses modal)

Style all screens with dark theme (Colors.background, Colors.surface for inputs, Colors.primary for buttons).

Handle back navigation gracefully - warn if data will be lost (or just allow since it's a quick wizard).
  </action>
  <verify>
- npx tsc --noEmit
- Complete wizard flow: title -> ingredients -> details -> save
- New recipe appears in list after save (assuming 02-02 is complete)
  </verify>
  <done>Complete recipe creation wizard with title, ingredients, optional details, image upload, and save</done>
</task>

</tasks>

<verification>
After all tasks:
1. `npx tsc --noEmit` passes
2. Navigate from recipes list to /recipe/create opens modal
3. Can enter title and proceed to step 2
4. Can add multiple ingredients and proceed to step 3
5. Can fill optional fields and save
6. Save creates recipe in Convex (visible in dashboard or list)
7. Modal dismisses after successful save
</verification>

<success_criteria>
- Multi-step wizard navigates correctly (forward and back)
- Title and ingredients are required, others optional
- Free-form ingredient entry works (no structured parsing)
- Optional image can be selected and uploads on save
- Save mutation creates recipe with all provided data
- Wizard state preserved when navigating between steps
- Modal dismisses and recipe appears in list after save
</success_criteria>

<output>
After completion, create `.planning/phases/02-recipe-management/02-03-SUMMARY.md`
</output>
